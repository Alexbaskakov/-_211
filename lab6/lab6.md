# Лабораторная работа 5.2. Конфигурация IPv4 и IPv6
На этом этапе вы настроите сеть для поддержки как IPv4, так и IPv6.

## Топология сети
![](https://cyberlab.pacific.edu/images/1/4/3/9/8/14398938202b301c2a6de25b4bc6f81c62145b04-network-11.png)
Топология лабораторной работы №6 (Примечание: метки подсетей и пунктирные границы предназначены только для информационных целей)

Однако ПРЕЖДЕ, чем вы даже подумаете об открытии GNS3, вы должны сначала завершить проектирование сети, заполнив таблицы адресации.

##Проект сети IPv4

Вы можете выбирать адреса подсетей по своему усмотрению со следующими ограничениями:
  1. Все подсети должны находиться в диапазонах частных IP-адресов. Перекрытие с законными публичными IP-адресами — очень плохая практика.
  2. Все подсети должны быть сетями /18 для размещения большого количества хостов, за исключением подсети №5, которая должна быть сетью /30.
  3. Вы должны следовать соглашению и назначать IP-адреса шлюза по умолчанию либо с наименьшим используемым адресом узла, либо с самым высоким используемым адресом узла в подсети.

Совет. В Интернете доступно множество калькуляторов подсетей. Как и с любым калькулятором, важно знать, как им пользоваться!

Выберите подсети IPv4 для вашей сети:
| Subnet № |	Subnet Address a.b.c.d/n	| Number of IPs in Subnet	| Lowest Usable Host Address	| Highest Usable  Host Address |
|----------|----------------------------|-------------------------|-----------------------------|------------------------------|
|Номер подсети| Адрес подсети|Количество адресов подсети|Первый используемый адрес|Последний используемый адрес|
|1				 |                            |                         |                             |                              |
|2				 |                            |                         |                             |                              |
|3				 |                            |                         |                             |                              |
|4				 |                            |                         |                             |                              |
|5				 |                            |                         |                             |                              |


Заметка:
  • Адрес подсети должен содержать все нули для битов идентификатора хоста. Например, 192.168.10.0/24 (младшие 8 бит равны нулю)
  • Количество IP-адресов в подсети должно включать первый и последний адрес (с идентификатором хоста, состоящим из всех нулей и всех единиц соответственно)
Выберите IPv4-адреса для всех интерфейсов маршрутизатора, соответствующих подсетям, которые вы выбрали выше:

| Subnet | Host/Interface | IPv4 address (include /n)|
|--------|----------------|--------------------------|
|Подсеть | Имя хоста, интерфейс | IPv4 адрес с префиксом |
| 1 | Router1, Ether1 |  |
| 2 | Router1, Ether2 |  |
| 3 | Router2, Ether1 |  |
| 4 | Router2, Ether2 |  | 
| 5 | Router1, Ether3 |  |
| N/A | Router1, Ether4 | DHCP from NAT |

- Вам не нужно выбирать IPv4-адреса для WebTerms — они будут использовать DHCP для автоматической настройки своих IPv4-адресов.

## Проект IPv6 адресации

Краткая справка для напоминания:
Адрес IPv6 представлен в виде восьми групп из четырех шестнадцатеричных цифр, где каждая группа представляет 16 бит. Каждая группа отделяется двоеточием (`:`). Пример адреса IPv6: `2001:0db8:85a3:0000:0000:8a2e:0370:7334`. Чтобы сократить отображаемые адреса, начальные нули в каждой группе можно опустить, а самую длинную последовательность последовательных групп, состоящих только из нулей, можно заменить двумя двоеточиями (`::`).

Стандартный одноадресный IPv6-адрес состоит из двух частей: 64-битного префикса, используемого для маршрутизации, и 64-битного идентификатора интерфейса, используемого для идентификации хостов.

| Routing Prefix (64bit) | Interface ID (64bit) |
|------------------------|----------------------|
|`xxxx:xxxx:xxxx:xxxx` | `xxxx:xxxx:xxxx:xxxx`|

Выберите подсети IPv6 для своей сети. В этой лабораторной работе поставщик услуг Интернета присвоил Tiger Enterprises префикс `2001:0:F872::/48`. (Почему `2001`? Это часть глобальных одноадресных адресов IPv6 от IANA).
Этот 48-битный префикс оставляет 16 битов доступными для указания подсетей внутри корпоративной сети и еще 64 бита для идентификации хостов в каждой подсети. Выберите уникальный 16-битный идентификатор подсети для подсетей 1–5.

| Subnet № |	Routing Prefix (48bit)	| Subnet  ID (16bit)	| Interface ID (64bit)	| 
|----------|----------------------------|-------------------------|-----------------------------|
|Номер подсети| Префикс маршрутизации|Префикс подсети|Идентификатор интерфейса|
|1				 | 2001:0:F872 |  xxxx    |  xxxx:xxxx:xxxx:xxxx  |
|2				 | 2001:0:F872 |                         |                             |
|3				 | 2001:0:F872 |                         |                             |
|4				 | 2001:0:F872 |                         |                             |
|5				 | 2001:0:F872 |                         |                             |

 зависимости от выбранных вами подсетей IPv6 выберите IPv6-адреса для всех интерфейсов маршрутизатора.
 Эти адреса должны иметь вид xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx/64, указывая на то, что старшие 64 бита представляют префикс сети, а младшие 64 бита представляют хост в сети. Как и в IPv4, считается хорошим соглашением, чтобы IP-адреса маршрутизатора были либо наименьшим используемым адресом узла, либо самым высоким используемым адресом узла в подсети.
 
 | Subnet | Host/Interface | IPv6 address (include /n)|
|--------|----------------|--------------------------|
|Подсеть | Имя хоста, интерфейс | IPv4 адрес с префиксом |
| 1 | Router1, Ether1 |  |
| 2 | Router1, Ether2 |  |
| 3 | Router2, Ether1 |  |
| 4 | Router2, Ether2 |  | 
| 5 | Router1, Ether3 |  |
| N/A | Router1, Ether4 | DHCP from NAT |

 - Вам не нужно выбирать IPv6-адреса для WebTerms — они будут использовать сетевое обнаружение для автоматической настройки своих собственных IPv6-адресов.
 ## Конфигурация сети
 
1. Настройте имена хостов маршрутизаторов в GNS3, чтобы избежать путаницы (через графический интерфейс).
2. Настройте имена хостов маршрутизаторов в самом маршрутизаторе, чтобы избежать путаницы (через интерфейс командной строки).
3. Отключите DHCP-клиент на каждом маршрутизаторе. (Если вы не запускали Wireshark по ссылке, вы бы раньше не заметили, что новый маршрутизатор MikroTik по умолчанию запускает DHCP-клиент на Ether1, пытаясь автоматически настроить этот сетевой порт, чтобы новый администратор мог получить доступ к маршрутизатору по сети. Это не поможет нам здесь.) `ip dhcp-client print`, за которым следует `ip dhcp-client remove numbers=0`, устранит это.
4. Настройте DNS для `Router1` и `Router2` и `DHCPServer`, используя общедоступные IP-адреса DNS Google: `ip dns set server=8.8.8.8,8.8.4.4`, а затем `ip dns print` для подтверждения настройки.

### Настройка IPv4
1. Настройте адреса IPv4 на всех интерфейсах маршрутизатора, подключенных к подсетям.
2. Включите DHCP-клиент на `Router1` на порту, подключенном к NAT.
3. Включите NAT (IP-маскарадинг) на маршрутизаторе `Router1`, чтобы (после включения маршрутизации) вся сеть могла получить доступ к общедоступному Интернету.
Проверочные тесты:
1. Может ли `Router1` пинговать `Router2`? (только интерфейсы в подсети 5)
2. Может ли `Router1` пинговать `8.8.8.8` и `google.com`?

### Конфигурация OSPF

1. Настройте OSPF в подсетях 1–5.
2. Настройте OSPF для распространения (объявления) маршрута по умолчанию, присутствующего на Router1, по сети. (Этот маршрут по умолчанию был получен через DHCP-клиент от NAT и разрешает доступ в Интернет)


Проверочные тесты:
• Может ли `Router2` пропинговать `8.8.8.8` и `google.com`?
• Предоставьте снимок экрана, показывающий выходные данные маршрутизации `ospf route print` с маршрутизатора `Router2`. Должны быть видны маршруты к подсетям 1-5, а также маршрут по умолчанию через `Router1` (в сторону NAT)

### Конфигурация DHCP
1. Настройте `DHCPServer` со статическим IP-адресом и маршрутом по умолчанию.
1. Проверка. Прежде чем продолжить, убедитесь, что DHCPServer может выполнить эхо-запрос `Router1`, `8.8.8.8` и `google.com`. Пока он не находится в сети в качестве функционального хоста, нет смысла настраивать его как DHCP-сервер.
2. Настройте `DHCPServer` с необходимыми параметрами для работы в качестве DHCP-сервера для подсетей 1–4. Примечание. Для подсети 4 ретранслятор DHCP не требуется — сервер находится в этой подсети. Подсеть 5 не использует DHCP, поскольку в ней есть только два устройства — маршрутизаторы.
3. Настройте ретрансляторы DHCP на `Router1` и `Router2` для подсетей 1–3.
4. Настройте `Webterms` для использования DHCP
• Предоставьте скриншот печати аренды `ip dhcp-server` на `DHCPServer`, показывающий четыре ожидаемых аренды.
• Предоставьте снимок экрана, показывающий, что `webterm-1` пингует как `webterm-4`, так и `google.com`.

### Конфигурация IPv6

Чтобы настроить роутер Mikrotik для IPv6:
• Включите пакет IPv6 и перезагрузите маршрутизатор: `system package enable ipv6`  с `system reboot`. (Если вы регулярно используете безопасный режим, убедитесь, что вы вышли из безопасного режима с помощью `[CTRL]+[X]`, чтобы не потерять всю свою работу!)
• Настройте интерфейс IPv6: адрес `ipv6 add address=xxxx:xxxx:xxxx:.......:xxxx/n interface=etherX`
• Проверьте конфигурацию интерфейса: `ipv6 address print ` (вы увидите локальные адреса ссылки в форме `fe80:xxxx` — они настраиваются автоматически и могут быть проигнорированы)
• Обнаружение соседей выполняется автоматически: `ipv6 nd print`. В результате маршрутизатор периодически рассылает «объявление маршрутизатора» по всем интерфейсам, а узлы, желающие присоединиться к сети, используют этот маршрутизатор в качестве шлюза по умолчанию и генерируют IPv6-адреса на основе объявленного префикса. Этот процесс называется автонастройкой адресов без сохранения состояния (SLAAC). Вы можете увидеть конкретные рекламируемые префиксы через `ipv6 nd prefix print`. (Совет: если префиксы отображаются как «Недействительные» и вы уверены, что ваши IPv6-адреса на каждом интерфейсе действительны, попробуйте перезагрузить маршрутизатор.)


Чтобы проверить конфигурацию IPv6 на веб-терминалах (которые являются общими устройствами Linux):

• Просмотр IP-адреса: `ip addr` (IPv4 — это линии inet, IPv6 — это линии inet6)
o Просмотр только адресов IPv4: `ip -4 addr`
o Просмотр только адресов IPv4: `ip -6 addr`
• Просмотр таблицы маршрутизации:
o Таблица маршрутизации IPv4: `ip route`
o Таблица маршрутизации IPv6: `ip -6 route`
• Проверка связности:
o Пинг IPv4: `ping`
o Пинг IPv6: `ping6`


• Предоставьте снимок экрана, показывающий, что `webterm-1` успешно пингует `webterm-2` по `IPv6` с помощью команды `ping6`.
• Предоставьте снимок экрана, показывающий эхо-запросы IPv6, захваченные в Wireshark. Вы можете фильтровать `icmpv6`, чтобы увидеть весь трафик ICMPv6 (пинги и другие сетевые уведомления), или фильтровать только `icmpv6.type==128 || icmpv6.type==129`, чтобы увидеть только эхо-запросы IPv6, как эхо-ответ, так и эхо-ответ.
• Предоставьте снимок экрана, на котором программа Wireshark зафиксировала пакет «Объявление маршрутизатора», используемый для уведомления всех хостов с поддержкой IPv6 в подсети о подключенном маршрутизаторе и префиксе маршрутизатора (для использования при автоматической настройке сети). Используйте фильтр icmpv6. Разверните поля, чтобы отчетливо отображался рекламируемый префикс (выбранный вами префикс для данной подсети).

### Маршрутизация IPv6

Из `webterm-1` попробуйте пропинговать `webterm-4` по `IPv6`. Какая у вас ошибка? (Пункт назначения недоступен: нет маршрута (Destination unreachable: No route)
Таблицы маршрутизации IPv6 необходимо настроить так же, как таблицы маршрутизации IPv4. Для IPv6 используется OSPFv3, тогда как для IPv4 использовался OSPFv2. Одно ключевое отличие от OSPFv3 заключается в том, что больше нет конфигурации для сетей, а конфигурация интерфейса становится обязательной, поскольку OSPFv3 работает на основе канала, а не на основе IP-подсети.


На каждом роутере:
• Добавьте нужные ссылки, подключенные к подсетям IPv6 (подсети 1-5): `routing ospf-v3 interface add interface=etherX area=backbone`
• Убедитесь, что ссылки добавлены: `routing ospf-v3 interface print`
• Убедитесь, что в таблице маршрутизации указаны подсети 1–5 в IPv6: `routing ospf-v3 route print`
• Убедитесь, что в таблице маршрутизации указаны подсети 1–5 в IPv6: `ipv6 route print`.

# Сдача лабораторной работы

Сдача производится отправкой файла отчета на почту 9999924816@ya.ru с включением в отчет следующих пунктов:

 - Заполненные таблицы из лабораторной работы
 - Снимок экрана, показывающий вашу топологию GNS3
 - Снимок экрана, показывающий выходные данные маршрутизации `ospf route print` с маршрутизатора Router2. Должны быть видны маршруты к подсетям 1-5, а также маршрут по умолчанию через Router1 (в сторону NAT)
 - Снимок экрана или вывод с консоли `ip dhcp-server lease print` на `DHCPServer`
 - Снимок экрана, подтверждающий доставку пакетов с `webterm-1` на `webterm-4` и выход в глобальную сеть
 - Снимок экрана, подтверждающий доставку пакетов с `webterm-1` на `webterm-2` по IPv6
 - Снимок экрана, показывающий захваченные в Wireshark пакеты IPv6. Вы можете использовать фильтр`icmpv6`, чтобы увидеть весь трафик ICMPv6 (пинги и другие сетевые уведомления), или фильтровать только icmpv6.type==128 || icmpv6.type==129, чтобы увидеть только эхо-запросы IPv6.
 - Снимок экрана, показывающий захваченное сообщение "Router Advertisement", используемое для уведомления всех хостов с поддержкой IPv6 в подсети о подключенном маршрутизаторе и префиксе маршрутизатора (для использования при автоматической настройке сети). Используйте фильтр icmpv6. Разверните поля, чтобы отчетливо отображался предлагаемый префикс (выбранный вами префикс для данной подсети).
 - Снимок экрана, показывающий связность `webterm-1` и `webterm-4` с использованием команды `ping6`
 - Снимок экрана или вывод консоли, отображающий выполнение команды `ipv6 route print` на `Router1`
 
Когда закончите, нажмите кнопку «Стоп» и выйдите из GNS3. Виртуальная машина GNS3 (в VMware) должна остановиться и выйти автоматически.
